"use strict";(self.webpackChunkflashbot_docs=self.webpackChunkflashbot_docs||[]).push([[245],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>h});var r=a(7294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function n(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?n(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,r,i=function(e,t){if(null==e)return{};var a,r,i={},n=Object.keys(e);for(r=0;r<n.length;r++)a=n[r],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)a=n[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var s=r.createContext({}),c=function(e){var t=r.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},d=function(e){var t=c(e.components);return r.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var a=e.components,i=e.mdxType,n=e.originalType,s=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),u=c(a),h=i,b=u["".concat(s,".").concat(h)]||u[h]||p[h]||n;return a?r.createElement(b,l(l({ref:t},d),{},{components:a})):r.createElement(b,l({ref:t},d))}));function h(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var n=a.length,l=new Array(n);l[0]=u;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:i,l[1]=o;for(var c=2;c<n;c++)l[c]=a[c];return r.createElement.apply(null,l)}return r.createElement.apply(null,a)}u.displayName="MDXCreateElement"},552:(e,t,a)=>{a.r(t),a.d(t,{frontMatter:()=>n,contentTitle:()=>l,metadata:()=>o,toc:()=>s,default:()=>d});var r=a(7462),i=(a(7294),a(3905));const n={},l=void 0,o={unversionedId:"flashbots-mev-boost/relays",id:"flashbots-mev-boost/relays",isDocsHomePage:!1,title:"relays",description:"Relay Fundamentals",source:"@site/docs/flashbots-mev-boost/relays.md",sourceDirName:"flashbots-mev-boost",slug:"/flashbots-mev-boost/relays",permalink:"/flashbots-mev-boost/relays",tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"block proposers",permalink:"/flashbots-mev-boost/block proposers"},next:{title:"system-requirements",permalink:"/flashbots-mev-boost/getting-started/system-requirements"}},s=[{value:"Relay Fundamentals",id:"relay-fundamentals",children:[]},{value:"Relay API Specification",id:"relay-api-specification",children:[{value:"Proposer API",id:"proposer-api",children:[]},{value:"Block Builder API",id:"block-builder-api",children:[]},{value:"Data API",id:"data-api",children:[]}]},{value:"Relay Monitor",id:"relay-monitor",children:[]},{value:"Circuit Breaker",id:"circuit-breaker",children:[]}],c={toc:s};function d({components:e,...t}){return(0,i.kt)("wrapper",(0,r.Z)({},c,t,{components:e,mdxType:"MDXLayout"}),(0,i.kt)("h3",{id:"relay-fundamentals"},"Relay Fundamentals"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"What is a Relay?")),(0,i.kt)("p",null,"Relays are a doubly-trusted data-availability layer and communication interface between builders and validators. Relays are trusted by builders for fair payload routing, and trusted by proposers for block validity, accuracy, and data availability. They are often specialized in Denial of Service (DoS) protection and networking."),(0,i.kt)("p",null,"Relays can connect to one or many builders, and we expect that there will be both variants. A relay connecting to many builders will aggregate their bids (fun fact: in a previous iteration, we called them builder aggregators or builder pools). The relay can see all the blocks submitted by the builders to confirm their validity and how much they pay to the validator. The relay then only submits the highest valid bid to the validator to sign."),(0,i.kt)("p",null,"Before validators can receive any bids from relays, they need to ",(0,i.kt)("a",{parentName:"p",href:"https://boost.flashbots.net/"},"set up mev-boost")," and add relays to their mev-boost config. mev-boost is effectively just a relay aggregator or a local relay of relays. It will serve the validator the winning bid from all relays. A validator can connect to a small number of relays that aggregate all the builders, and many will probably do that. Other validators might connect to many relays."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"The Role of Relays")),(0,i.kt)("p",null,"A relay has several responsibilities:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"They execute ",(0,i.kt)("a",{parentName:"li",href:"https://ethereum.github.io/builder-specs/#/Builder"},"builder-spec")," and data transparency API functionality."),(0,i.kt)("li",{parentName:"ul"},"Handle validator registrations and block proposals in a scalable manner."),(0,i.kt)("li",{parentName:"ul"},"Provide block escrow and data availability."),(0,i.kt)("li",{parentName:"ul"},"Simulate and verify blocks sent by block-builders, and rate-limit as necessary. Relays simulate whether:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"the correct amount of fees are paid to recent validator feeRecipient."),(0,i.kt)("li",{parentName:"ul"},"the correct block attributes and transactions exist."),(0,i.kt)("li",{parentName:"ul"},"the block gas is within the gasLimit requested by validator.")))),(0,i.kt)("h2",{id:"relay-api-specification"},(0,i.kt)("a",{parentName:"h2",href:"https://flashbots.notion.site/Relay-API-Spec-5fb0819366954962bc02e81cb33840f5"},"Relay API Specification")),(0,i.kt)("p",null,"The current specification for the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/flashbots/mev-boost-relay"},"open-source Flashbots relay"),". Diagram below displays the current architecture:"),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://flashbots.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fc4460f24-9643-470a-a956-d886bf92e354%2FScreenshot_2022-06-22_at_17.54.56.png?table=block&id=ed097235-1a1d-497f-b3a4-f2c4673ac26e&spaceId=df6156be-4a40-4dc3-9a41-d3def62df57a&width=2000&userId=&cache=v2",alt:"Flashbots Relay"})),(0,i.kt)("h3",{id:"proposer-api"},(0,i.kt)("a",{parentName:"h3",href:"https://flashbots.notion.site/Relay-API-Spec-5fb0819366954962bc02e81cb33840f5"},"Proposer API")),(0,i.kt)("p",null,"Standard ",(0,i.kt)("a",{parentName:"p",href:"https://ethereum.github.io/builder-specs/#/Builder"},"builder spec")," APIs"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://ethereum.github.io/builder-specs/#/Builder/registerValidator"},"registerValidator"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"POST /eth/v1/builder/validators")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://ethereum.github.io/builder-specs/#/Builder/getHeader"},"getHeader"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"GET  /eth/v1/builder/header/{slot}/{parent_hash}/{pubkey}")," - Get an execution payload header."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://ethereum.github.io/builder-specs/#/Builder/submitBlindedBlock"},"submitBlindedBlock"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"POST /eth/v1/builder/blinded_blocks")," - Submit a signed blinded block and get unblinded execution payload."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://ethereum.github.io/builder-specs/#/"},"status"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"GET /eth/v1/builder/status"))),(0,i.kt)("h3",{id:"block-builder-api"},(0,i.kt)("a",{parentName:"h3",href:"https://flashbots.notion.site/Relay-API-Spec-5fb0819366954962bc02e81cb33840f5"},"Block Builder API")),(0,i.kt)("p",null,"Get a list of validator registrations for the current and next epoch, submit a new block to the relay."),(0,i.kt)("h3",{id:"data-api"},(0,i.kt)("a",{parentName:"h3",href:"https://flashbots.notion.site/Relay-API-Spec-5fb0819366954962bc02e81cb33840f5"},"Data API")),(0,i.kt)("p",null,"Provides data about received blocks from builders, payloads delivered to proposers as well as insights into validator registrations."),(0,i.kt)("h2",{id:"relay-monitor"},(0,i.kt)("a",{parentName:"h2",href:"https://hackmd.io/@ralexstokes/SynPJN_pq"},"Relay Monitor")),(0,i.kt)("p",null,"While relays are trusted actors, the ability to run a relay is permissionless. To mitigate potential abuses of this role, Flashbots ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/flashbots/mev-boost/issues/142"},"has suggested")," a \u201crelay monitor,\u201d which uses publicly available data to form a view on the\xa0behavior and\xa0performance of the set of relays it is monitoring. More details can be found in the ",(0,i.kt)("a",{parentName:"p",href:"https://hackmd.io/@ralexstokes/SynPJN_pq"},"relay monitor design documentation"),", ",(0,i.kt)("a",{parentName:"p",href:"https://notes.ethereum.org/@yoav/BJeOQ8rI5"},"keeping MEV-Boost relays honest"),", and ",(0,i.kt)("a",{parentName:"p",href:"https://writings.flashbots.net/writings/understanding-mev-boost-liveness-risks"},"understanding liveness risks"),"."),(0,i.kt)("h2",{id:"circuit-breaker"},(0,i.kt)("a",{parentName:"h2",href:"https://hackmd.io/@ralexstokes/BJn9N6Thc"},"Circuit Breaker")),(0,i.kt)("p",null,"The circuit breaker is implemented by client software teams to define \u201ccircuit breaking\u201d conditions using globally available inputs (simply, the chain) which determine whether clients should make a decision to terminate an external builder network in favor of local block production. Once the circuit breaker condition is met, the only way to reset the state is to restart the beacon node where the missing slots tally will be 0."),(0,i.kt)("p",null,"Each consensus client implements different circuit breaker conditions, as an example:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Name"),(0,i.kt)("th",{parentName:"tr",align:null},"Value"),(0,i.kt)("th",{parentName:"tr",align:null},"Units"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"MAX_ALLOWED_MISSING_SLOTS"),(0,i.kt)("td",{parentName:"tr",align:null},"5"),(0,i.kt)("td",{parentName:"tr",align:null},"slot(s)")))))}d.isMDXComponent=!0}}]);